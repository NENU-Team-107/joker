<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://unpkg.com/@antv/l7'></script>
    <script src='/node_modules/@antv/g2/dist/g2.min.js'></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet' />

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>
    <title>Along Years</title>
</head>

<body>
    <div id="map"></div>
</body>
<style>
    html,
    body,
    #map {
        height: 100%;
        width: 100vw;
        padding: 0;
        margin: 0;
    }
</style>
<script>
    const scene = new L7.Scene({
        id: 'map',
        map: new L7.GaodeMap({
            style: 'dark', // 样式URL
            center: [2.6125016864608597, 49.359131],
            pitch: 30,
            zoom: 4.1,
            token: '44777c023d04078893270a8be6d5c9e0',
        }),
    });
    scene.on('loaded', () => {
        $.when($.getJSON('/src/assets/happiness2019.json'))
            .done((data) => {
                const pointLayer = new L7.PointLayer({})
                    .source(data)
                    .animate(true)
                    .active(true)
                    .shape('name', ['cylinder', 'triangleColumn', 'hexagonColumn', 'squareColumn'])
                    .color('#006CFF')
                    .size('happiness', h => [6, 6, Math.floor(h) * 10])
                    .style({
                        opacity: 0.8,
                        sourceColor: 'red',
                        targetColor: 'yellow',
                        lightEnable: false

                    });
                const color = ['rgb(255,255,217)', 'rgb(237,248,177)', 'rgb(199,233,180)', 'rgb(127,205,187)', 'rgb(65,182,196)', 'rgb(29,145,192)'];
                const polyLayer = new L7.PolygonLayer({})
                    .source(data)
                    .scale('happiness', {
                        type: 'linear'
                    })
                    .color(
                        'happiness', color
                    )
                    .shape('fill')
                    .active(true);
                const lineLayer = new L7.LineLayer({
                    zIndex: 2
                })
                    .source(data)
                    .color('#fff')
                    .active(true)
                    .size(1)
                    .style({
                        lineType: 'dash',
                        dashArray: [2, 2],
                    });
                scene.addLayer(lineLayer);
                scene.addLayer(polyLayer);
                scene.addLayer(pointLayer);
            });
    })
</script>

</html>